<!DOCTYPE html>
<html>
	<head>
		<link rel="shortcut icon" type="image/ico" href="images/favicon.ico" id="favicon">
	</head>
	<body>
		
		
		
		<script>
		// create the canvas
		var canvas = document.createElement("CANVAS");
		var ctx = canvas.getContext("2d");
		canvas.width = 16;
		canvas.height = 16;
		
		// load game resources
		var images = [];
		
		// prepares an image to be loaded and returns the element
		function addImage(imgSrc) {
			var newImg = new Image();
			images.push({img:newImg, src:imgSrc});
			return newImg;
		}
			
		// load each image and then start the game loop
		function loadImages() {
			if (images.length > 0) {
				
				// load the first image in the array
				images[0].img.onload = loadImages;
				images[0].img.src = images[0].src;
				
				// delete the first element of the array
				images.shift();
				
			} else {
				start();
				console.log("start");
			}
		}
		
		// create image objects
		var dinoImage 		= addImage("images/dino.png");
		var cacti 		= addImage("images/cacti.png");
		var pressSpace 		= addImage("images/press_space.png");
		var digits 		= addImage("images/digits.png");
		
		loadImages();
		
		// sets the favicon (duh)
		function setFavicon() {
			var favicon = document.getElementById("favicon");
			var newIcon = favicon.cloneNode(true);
			newIcon.setAttribute("href", canvas.toDataURL());
			favicon.parentNode.replaceChild(newIcon, favicon);
		}
			
		// event handling
		var spaceDown = false;
		window.addEventListener("keydown", function(event) {
			// 32 = space
			if (event.keyCode == 32) {
				spaceDown = true;
			}
		})
		window.addEventListener("keyup", function(event) {
			// 32 = space
			if (event.keyCode == 32) {
				spaceDown = false;
			}
		})
		
		// game state function
		var currentState = titleScreen;
			
		// game loop
		function start() {
			// start the first game state
			titleScreenStart();
			
			// start the game loop
			window.setInterval(function() {
				currentState();
				setFavicon();
			}, 50);
		}
			
		/* game states */
			
		// title screen
		var showPressSpace = true;
		var toggleSpaceInterval;
		function titleScreenToggleSpace() {
			showPressSpace = !showPressSpace;
		}
		
		function titleScreenStart() {
			toggleSpaceInterval = window.setInterval(titleScreenToggleSpace, 500);
		}
			
		function titleScreen() {
			titleScreenUpdate();
			titleScreenRender();
		}
		
		function titleScreenUpdate() {
			if (spaceDown) {
				titleScreenQuit();
				currentState = game;
				gameStart();	
			}
		}
			
		function titleScreenRender() {
			// clear the canvas
			ctx.fillStyle="#fff";
			ctx.fillRect(0,0,16,16);
			
			// draw game objects
			if (showPressSpace) {
				ctx.drawImage(pressSpace, 0, 0);
			}
			ctx.drawImage(dinoImage, 0, 11);
		}
			
		function titleScreenQuit() {
			window.clearInterval(toggleSpaceInterval);
		}
			
		// game
		var dinoX = 8; // the tip of the dino's nose
		var dinoY = 0; // the bottom of the dino's feet (distance from bottom of icon)
		var yVel = 0.0;
		function gameStart() {
			yVel = 0.2;
		}
			
		function game() {
			gameUpdate();
			gameRender();
		}
			
		function gameUpdate() {
			dinoY += yVel;
			if (dinoY <= 0) {
				dinoY = 0;
				yVel = 0.0;
			}
			
			if (dinoY > 0) {
				yVel -= 0.05;
			} else {
				if (spaceDown) {
					yVel = 2.0;
				}
			}
		}
		
		function gameRender() {
			// clear the canvas
			ctx.fillStyle="#fff";
			ctx.fillRect(0,0,16,16);
			
			// draw dino
			ctx.drawImage(dinoImage, 0, 16 - (dinoY + 6) + 1);
		}
			
		function gameQuit() {
			yVel = 0;
		}
			
		// game over
		function gameOver() {
			// do stuff
		}
		
		</script>
	</body>
</html>
